<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout (~{::title}, ~{::main})}"></div>
<head>
    <title>InÃ­cio</title>
</head>
<main>
    <div th:if="${mensagem}" style="color: green;" th:text="${mensagem}"></div>
    <div th:if="${erro}" style="color: red;" th:text="${erro}"></div>
    <h1>ðŸ“š Lista de Livros</h1>

    <form method="get" action="/">
        <input type="text" name="busca" placeholder="Buscar livro..." />
        <select name="filtro">
            <option value="titulo">TÃ­tulo</option>
            <option value="autor">Autor</option>
            <option value="categoria">Categoria</option>
        </select>
        <button type="submit">Buscar</button>
    </form>

    <!-- botao emprestimo de livros para alunos -->
    <div th:if="${usuarioLogado != null and usuarioLogado.tipo.name() == 'ALUNO'}">
        <a href="/emprestimos/emprestimos">ðŸ“– Ver meus emprÃ©stimos</a>
    </div>

    <!-- tRECHO QUE ADICIONA O BOTÃƒO ADD LIVRO SE O USUARIO FOR admin-->
    <div th:if="${usuarioLogado != null and (usuarioLogado.tipo.name() == 'ADMIN' or usuarioLogado.tipo.name() == 'FUNCIONARIO')}">
        <a href="/livros/novo">âž• Adicionar Livro</a>
    </div>

    <!-- cadastro de funcionarios apenas para ADM-->
    <div th:if="${usuarioLogado != null and usuarioLogado.tipo.name() == 'ADMIN'}">
        <a href="/usuarios/novo">ðŸ‘¥ Cadastrar FuncionÃ¡rio/ADM</a>
    </div>

    <table border="1">
        <thead>
        <tr>
            <th>TÃ­tulo</th>
            <th>Autor</th>
            <th>ISBN</th>
            <th>Categoria</th>
            <th>AÃ§Ã£o</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="livro : ${livros}">
            <td th:text="${livro.titulo}"></td>
            <td th:text="${livro.autor}"></td>
            <td th:text="${livro.isbn}"></td>
            <td th:text="${livro.categoria}"></td>
            <td>
                <!-- Apenas ALUNO pode ver o botÃ£o "Alugar" -->
                <a th:if="${usuarioLogado.tipo.name() == 'ALUNO'}"
                   th:href="@{'/emprestimos/alugar/' + ${livro.id}}">Alugar</a>

                <!-- ADMIN e FUNCIONARIO podem ativar/desativar -->
                <span th:if="${usuarioLogado.tipo.name() == 'ADMIN' or usuarioLogado.tipo.name() == 'FUNCIONARIO'}">
        |
        <a th:href="@{'/livros/ativar-desativar/' + ${livro.id}}">
            <span th:text="${livro.ativo} ? 'Desativar' : 'Ativar'"></span>
        </a>
    </span>
            </td>

        </tr>
        </tbody>
    </table>
</main>
</html>
